# 2025-08-17

## Prepare for Pulication on GitHub

Spend some time cleaning and polishing.

## Notification

We would like a way for the MCP client to request notification
when a message is received on a specified topic.
Let's think about how this could be accomplished.

## Plan: Client Topic Subscription with Optional MCP Event Notification

1. **Subscription Request**
   - Client calls the `mqtt-subscribe` tool, providing:
     - Topic to subscribe
     - QoS level
     - Notification preference (boolean: notify or not)

2. **Server Subscription Handling**
   - Server subscribes to the topic as requested.
   - Stores the client's notification preference in connection/session state.

3. **Message Arrival**
   - When a message arrives on a subscribed topic:
     - If notification is enabled for the client, send an MCP event with message details (topic, payload, timestamp, etc.).
     - If notification is disabled, message is logged/stored but no event is sent.

4. **MCP Event Format**
   - Define a standard MCP event schema for message notifications:
     - Event type: `mqtt.message`
     - Fields: connection_id, topic, payload, qos, retain, timestamp

5. **Persistent Subscriptions**
   - Optionally persist notification preferences for reconnection scenarios.

6. **Unsubscribe/Update**
   - Client can update notification preference or unsubscribe via tool calls.

## Plan: Add Unit Tests

- Add unit tests for mqtt_bridge.direct
- Add unit tests for mqtt_bridge.server
- Add unit tests for mqtt_bridge.subscription_persistence
- Use `uv run pytest src/tests` to run the tests
- Add test results to the ./journal.
